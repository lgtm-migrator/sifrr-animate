{"version":3,"file":"sifrr.animate.js","sources":["../src/bezier.js","../src/types.js","../src/wait.js","../src/animateone.js","../src/animate.js"],"sourcesContent":["const beziers = {};\n\nclass Bezier {\n  constructor(args){\n    const key = args.join('_');\n    if (!beziers[key]) {\n      this.setProps(...args);\n      beziers[key] = this.final.bind(this);\n    }\n    return beziers[key];\n  }\n\n  setProps(x1, y1, x2, y2) {\n    let props = {\n      x1, y1, x2, y2,\n      A: (aA1, aA2) => 1.0 - 3.0 * aA2 + 3.0 * aA1,\n      B: (aA1, aA2) => 3.0 * aA2 - 6.0 * aA1,\n      C: (aA1) => 3.0 * aA1,\n      CalcBezier: (aT, aA1, aA2) => ((this.A(aA1, aA2)*aT + this.B(aA1, aA2))*aT + this.C(aA1))*aT,\n      GetSlope: (aT, aA1, aA2) => 3.0 * this.A(aA1, aA2)*aT*aT + 2.0 * this.B(aA1, aA2) * aT + this.C(aA1)\n    };\n    Object.assign(this, props);\n  }\n\n  final(x) {\n    if (this.x1 == this.y1 && this.x2 == this.y2) return x;\n    return this.CalcBezier(this.GetTForX(x), this.y1, this.y2);\n  }\n\n  GetTForX(xx) {\n    let t = xx;\n    for (let i = 0; i < 4; ++i) {\n      let slope = this.GetSlope(t, this.x1, this.x2);\n      if (slope == 0) return t;\n      let x = this.CalcBezier(t, this.x1, this.x2) - xx;\n      t -= x / slope;\n    }\n    return t;\n  }\n}\n\nmodule.exports = Bezier;\n","module.exports = {\n  linear: [0, 0, 1, 1],\n  ease: [.25, .1, .25, 1],\n  easeIn: [.42, 0, 1, 1],\n  easeOut: [0, 0, .58, 1],\n  easeInOut: [.42, 0, .58, 1]\n};\n","/* istanbul ignore next: function */\nmodule.exports = (t = 0) => new Promise(res => setTimeout(res, t));\n","const Bezier = require('./bezier');\nconst types = require('./types');\nconst wait = require('./wait');\nconst digitRgx = /(\\d+\\.?\\d*)/;\n\nfunction animateOne({\n  target,\n  prop,\n  from,\n  to,\n  time = 300,\n  type = 'ease',\n  onUpdate,\n  round = false,\n  delay = 0 // number\n}) {\n  const toSplit = to.toString().split(digitRgx), l = toSplit.length, raw = [], fromNums = [], diffs = [];\n  const fromSplit = (from || target[prop] || '').toString().split(digitRgx);\n  const onUp = typeof onUpdate === 'function';\n  for (let i = 0; i < l; i++) {\n    const n = Number(toSplit[i]);\n    if (isNaN(n) || !toSplit[i]) raw.push(toSplit[i]);\n    else {\n      fromNums.push(Number(fromSplit[i]) || 0);\n      diffs.push(n - (Number(fromSplit[i]) || 0));\n    }\n  }\n  type = typeof type === 'function' ? type : new Bezier(types[type] || type);\n\n  return wait(delay).then(() => new Promise(res => {\n    let startTime = performance.now();\n    function frame(currentTime) {\n      const percent = (currentTime - startTime) / time, bper = type(percent >= 1 ? 1 : percent);\n      const next = diffs.map((d, i) => {\n        const next = bper * d + fromNums[i];\n        return round ? Math.round(next) : next;\n      });\n      const val = String.raw({ raw }, ...next);\n      target[prop] = Number(val) || val;\n      if (onUp) onUpdate(target, prop, target[prop]);\n      if (percent >= 1) return res();\n      window.requestAnimationFrame(frame);\n    }\n    window.requestAnimationFrame(frame);\n  }));\n}\n\nmodule.exports = animateOne;\n","const animateOne = require('./animateone');\n\nfunction animate({\n  targets,\n  target,\n  to, // object or function\n  time,\n  type,\n  onUpdate,\n  round,\n  delay // number or function\n}) {\n  targets = targets ? Array.from(targets) : [target];\n  let numDelay = delay;\n  function iterate(t, props, index) {\n    if (typeof delay === 'function') numDelay = delay(index);\n    const promises = [];\n    for (let prop in props) {\n      let from, final;\n      if (Array.isArray(props[prop])) [from, final] = props[prop];\n      else final = props[prop];\n      if (typeof props[prop] === 'object' && !Array.isArray(props[prop])) {\n        promises.push(iterate(t[prop], props[prop], index));\n      } else {\n        promises.push(animateOne({\n          target: t,\n          prop,\n          to: final,\n          time,\n          type,\n          from,\n          onUpdate,\n          round,\n          delay: numDelay\n        }));\n      }\n    }\n    return Promise.all(promises);\n  }\n  let numTo;\n  return Promise.all(targets.map((target, i) => {\n    numTo = to;\n    if (typeof to === 'function') numTo = to(i);\n    return iterate(target, numTo, i);\n  }));\n}\n\nanimate.types = require('./types');\nanimate.wait = require('./wait');\nanimate.animate = animate;\n\nmodule.exports = animate;\n"],"names":["beziers","Bezier","constructor","args","key","join","setProps","final","bind","x1","y1","x2","y2","props","A","aA1","aA2","B","C","CalcBezier","aT","GetSlope","Object","assign","x","GetTForX","xx","t","i","slope","linear","ease","easeIn","easeOut","easeInOut","Promise","res","setTimeout","digitRgx","animateOne","target","prop","from","to","time","type","onUpdate","round","delay","toSplit","toString","split","l","length","raw","fromNums","diffs","fromSplit","onUp","n","Number","isNaN","push","types","wait","then","startTime","performance","now","frame","currentTime","percent","bper","next","map","d","Math","val","String","window","requestAnimationFrame","animate","targets","Array","numDelay","iterate","index","promises","isArray","all","numTo","require$$0","require$$1"],"mappings":"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"}