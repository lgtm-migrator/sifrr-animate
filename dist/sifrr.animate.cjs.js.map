{"version":3,"file":"sifrr.animate.cjs.js","sources":["../src/bezier.js","../src/types.js","../src/animateone.js","../src/animate.js"],"sourcesContent":["const beziers = {};\n\nclass Bezier {\n  constructor(args) {\n    const key = args.join('_');\n    if (!beziers[key]) {\n      this.setProps(...args);\n      beziers[key] = this.final.bind(this);\n    }\n    return beziers[key];\n  }\n\n  setProps(x1, y1, x2, y2) {\n    let props = {\n      x1,\n      y1,\n      x2,\n      y2,\n      A: (x1, x2) => 1.0 - 3.0 * x2 + 3.0 * x1,\n      B: (x1, x2) => 3.0 * x2 - 6.0 * x1,\n      C: x1 => 3.0 * x1,\n      CalcBezier: (t, x1, x2) =>\n        ((this.A(x1, x2) * t + this.B(x1, x2)) * t + this.C(x1)) * t,\n      GetSlope: (t, x1, x2) =>\n        3.0 * this.A(x1, x2) * t * t + 2.0 * this.B(x1, x2) * t + this.C(x1)\n    };\n    Object.assign(this, props);\n  }\n\n  final(x) {\n    if (this.x1 == this.y1 && this.x2 == this.y2) return x;\n    return this.CalcBezier(this.GetTForX(x), this.y1, this.y2);\n  }\n\n  GetTForX(xx) {\n    let t = xx;\n    for (let i = 0; i < 4; ++i) {\n      let slope = this.GetSlope(t, this.x1, this.x2);\n      if (slope == 0) return t;\n      let x = this.CalcBezier(t, this.x1, this.x2) - xx;\n      t -= x / slope;\n    }\n    return t;\n  }\n}\n\nexport default Bezier;\n","export const linear = [0, 0, 1, 1];\nexport const ease = [0.25, 0.1, 0.25, 1];\nexport const easeIn = [0.42, 0, 1, 1];\nexport const easeOut = [0, 0, 0.58, 1];\nexport const easeInOut = [0.42, 0, 0.58, 1];\nexport const spring = [0.3642, 0, 0.6358, 1];\n","import Bezier from './bezier';\nimport * as types from './types';\nconst digitRgx = /((?:[+\\-*/]=)?-?\\d+\\.?\\d*)/;\nconst frames = new Set();\n\nfunction runFrames(currentTime) {\n  frames.forEach(f => f(currentTime));\n  window.requestAnimationFrame(runFrames);\n}\nwindow.requestAnimationFrame(runFrames);\n\nfunction animateOne({\n  target,\n  prop,\n  from,\n  to,\n  time = 300,\n  type = 'spring',\n  onUpdate,\n  round = false,\n  delay = 0 // number\n}) {\n  const toSplit = to.toString().split(digitRgx),\n    l = toSplit.length,\n    raw = [],\n    fromNums = [],\n    diffs = [];\n  const fromSplit = (from || target[prop] || '').toString().split(digitRgx);\n  const onUp = typeof onUpdate === 'function';\n  for (let i = 0; i < l; i++) {\n    const fn = Number(fromSplit[i]) || 0;\n    let tn;\n    if (toSplit[i][1] === '=') {\n      tn = Number(toSplit[i].slice(2));\n      switch (toSplit[i][0]) {\n        case '+':\n          tn = fn + tn;\n          break;\n        case '-':\n          tn = fn - tn;\n          break;\n        case '*':\n          tn = fn * tn;\n          break;\n        case '/':\n          tn = fn / tn;\n          break;\n      }\n    } else tn = Number(toSplit[i]);\n    if (isNaN(tn) || !toSplit[i]) raw.push(toSplit[i]);\n    else {\n      fromNums.push(fn);\n      diffs.push(tn - fn);\n    }\n  }\n\n  const rawObj = { raw };\n  return new Promise((resolve, reject) => {\n    if (types[type]) type = types[type];\n    if (Array.isArray(type)) type = new Bezier(type);\n    else if (typeof type !== 'function')\n      return reject(\n        Error(\n          'type should be one of ' +\n            Object.keys(types).toString() +\n            ' or Bezier Array or Function, given ' +\n            type\n        )\n      );\n\n    const startTime = performance.now() + delay;\n    const frame = function(currentTime) {\n      const percent = (currentTime - startTime) / time,\n        bper = type(percent > 1 ? 1 : percent);\n      if (percent < 0) return;\n      const next = diffs.map((d, i) => {\n        const n = bper * d + fromNums[i];\n        return round ? Math.round(n) : n;\n      });\n      const val = String.raw(rawObj, ...next);\n      try {\n        target[prop] = Number(val) || val;\n        if (onUp) onUpdate(target, prop, target[prop]);\n        if (percent >= 1) resolve(frames.delete(frame));\n      } catch (e) {\n        frames.delete(frame);\n        reject(e);\n      }\n    };\n    frames.add(frame);\n  });\n}\n\nexport default animateOne;\n","import animateOne from './animateone';\n\nfunction animate({\n  targets,\n  target,\n  to, // object or function\n  time, // number or function\n  type,\n  onUpdate,\n  round,\n  delay // number or function\n}) {\n  targets = targets ? Array.from(targets) : [target];\n  function iterate(tg, props, d, ntime) {\n    const promises = [];\n    for (let prop in props) {\n      let from, final;\n      if (Array.isArray(props[prop])) [from, final] = props[prop];\n      else final = props[prop];\n      if (typeof props[prop] === 'object' && !Array.isArray(props[prop])) {\n        promises.push(iterate(tg[prop], props[prop], d, ntime));\n      } else {\n        promises.push(\n          animateOne({\n            target: tg,\n            prop,\n            to: final,\n            time: ntime,\n            type,\n            from,\n            onUpdate,\n            round,\n            delay: d\n          })\n        );\n      }\n    }\n    return Promise.all(promises);\n  }\n  let numTo = to,\n    numDelay = delay,\n    numTime = time;\n  return Promise.all(\n    targets.map((target, i) => {\n      if (typeof to === 'function') numTo = to.call(target, i);\n      if (typeof delay === 'function') numDelay = delay.call(target, i);\n      if (typeof time === 'function') numTime = time.call(target, i);\n      return iterate(target, numTo, numDelay, numTime);\n    })\n  );\n}\n\nanimate.types = require('./types');\nanimate.wait = require('./wait').default;\nanimate.animate = animate;\nanimate.keyframes = arrOpts => {\n  let promise = Promise.resolve(true);\n  arrOpts.forEach(opts => {\n    if (Array.isArray(opts))\n      promise = promise.then(() => Promise.all(opts.map(animate)));\n    promise = promise.then(() => animate(opts));\n  });\n  return promise;\n};\nanimate.loop = fxn => fxn().then(() => animate.loop(fxn));\n\nexport default animate;\n"],"names":["beziers","Bezier","constructor","args","key","join","setProps","final","bind","x1","y1","x2","y2","props","A","B","C","CalcBezier","t","GetSlope","Object","assign","x","GetTForX","xx","i","slope","linear","ease","easeIn","easeOut","easeInOut","spring","digitRgx","frames","Set","runFrames","currentTime","forEach","f","window","requestAnimationFrame","animateOne","target","prop","from","to","time","type","onUpdate","round","delay","toSplit","toString","split","l","length","raw","fromNums","diffs","fromSplit","onUp","fn","Number","tn","slice","isNaN","push","rawObj","Promise","resolve","reject","types","Array","isArray","Error","keys","startTime","performance","now","frame","percent","bper","next","map","d","n","Math","val","String","delete","e","add","animate","targets","iterate","tg","ntime","promises","all","numTo","numDelay","numTime","call","require","wait","default","keyframes","arrOpts","promise","opts","then","loop","fxn"],"mappings":"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"}